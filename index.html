<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Calculateur Bo√Ætes & Flacons (PWA)</title>
  <meta name="description" content="Calcul du nombre de bo√Ætes (comprim√©s, sirops, sachets, gouttes buvables, collyres) pour p√©riodes fixes, d√©gressives ou progressives.">
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#0ea5e9">
  <link rel="icon" href="icons/icon-192.png">
  <link rel="apple-touch-icon" href="icons/icon-192.png">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <span class="logo">üíä</span>
      <h1>Calculateur Bo√Ætes & Flacons</h1>
    </div>
    <button id="installBtn" class="btn secondary" hidden>Installer</button>
  </header>

  <main>
    <section class="card">
      <h2>Mode de calcul</h2>
      <div class="mode-switch">
        <label><input type="radio" name="mode" value="fixe" checked> P√©riode fixe</label>
        <label><input type="radio" name="mode" value="multi"> P√©riode d√©gressive / progressive (par paliers)</label>
      </div>
      <div id="phaseContainer" class="phases hidden">
        <div class="phase-actions">
          <button id="addPhase" class="btn">+ Ajouter un palier</button>
          <button id="clearPhases" class="btn danger">Effacer</button>
        </div>
        <div id="phases"></div>
      </div>
    </section>

    <section class="card">
      <h2>Forme</h2>
      <div class="tabs" role="tablist" aria-label="Forme pharmaceutique">
        <button class="tab active" data-tab="tab-comprime">Comprim√©s</button>
        <button class="tab" data-tab="tab-sirop">Sirop</button>
        <button class="tab" data-tab="tab-sachet">Sachet</button>
        <button class="tab" data-tab="tab-gouttes">Gouttes buvables</button>
        <button class="tab" data-tab="tab-collyre">Collyres</button>
      </div>

      <div class="panes">
        <div id="tab-comprime" class="pane active">
          <div class="grid">
            <div style="display:flex;gap:8px;align-items:end">
              <button id="sir_toggle" class="btn secondary" type="button">Basculer mg ‚Üî cuill√®re</button>
            </div>
            <label>Unit√©s par prise (comprim√©s)
              <input type="number" id="cmp_units" min="0" step="0.25" value="1">
            </label>
            <label>Fr√©quence / jour (prises)
              <input type="number" id="cmp_freq" min="0" step="0.5" value="2">
            </label>
            <label>Dur√©e (jours)
              <input type="number" id="cmp_days" min="0" step="1" value="7">
            </label>
            <label>Unit√©s par bo√Æte (comprim√©s/bo√Æte)
              <input type="number" id="cmp_per_box" min="1" step="1" value="30">
            </label>
          </div>
        </div>

        <div id="tab-sirop" class="pane">
          <div class="grid">
            <div style="display:flex;gap:8px;align-items:end">
              <button id="sir_toggle" class="btn secondary" type="button">Basculer mg ‚Üî cuill√®re</button>
            </div>
            <label>Mode de dose <span class="hint" id="sir_hint" title="√âquivalences :\n‚Ä¢ Cuill√®re √† caf√© = 2,5 mL\n‚Ä¢ Cuill√®re √† dessert = 5 mL\n‚Ä¢ Cuill√®re √† soupe = 15 mL">‚ìò</span>
              <select id="sir_spoon">
                <option value="0" selected>En mg (classique)</option>
                <option value="2.5">Cuill√®re √† caf√© (2,5 mL)</option>
                <option value="5">Cuill√®re √† dessert (5 mL)</option>
                <option value="15">Cuill√®re √† soupe (15 mL)</option>
              </select>
            </label>
            <label id="sir_dose_label">Dose par prise (mg) ou nombre de cuill√®res
              <div class="stepper" id="sir_stepper"><button class="stepper-btn" type="button" id="sir_minus">‚àí</button><input type="number" id="sir_dose_mg" min="0" step="0.1" value="200"><button class="stepper-btn" type="button" id="sir_plus">+</button></div>
            </label>
            <label>Concentration (mg/mL)
              <input type="number" id="sir_mg_per_ml" min="0" step="0.1" value="20">
            </label>
            <label>Fr√©quence / jour (prises)
              <input type="number" id="sir_freq" min="0" step="0.5" value="2">
            </label>
            <label>Dur√©e (jours)
              <input type="number" id="sir_days" min="0" step="1" value="7">
            </label>
            <label>Volume par flacon (mL)
              <input type="number" id="sir_bottle_ml" min="1" step="1" value="150">
            </label>
          </div>
        </div>

        <div id="tab-sachet" class="pane">
          <div class="grid">
            <div style="display:flex;gap:8px;align-items:end">
              <button id="sir_toggle" class="btn secondary" type="button">Basculer mg ‚Üî cuill√®re</button>
            </div>
            <label>Sachets par prise
              <input type="number" id="sac_units" min="0" step="0.25" value="1">
            </label>
            <label>Fr√©quence / jour (prises)
              <input type="number" id="sac_freq" min="0" step="0.5" value="2">
            </label>
            <label>Dur√©e (jours)
              <input type="number" id="sac_days" min="0" step="1" value="5">
            </label>
            <label>Sachets par bo√Æte
              <input type="number" id="sac_per_box" min="1" step="1" value="20">
            </label>
          </div>
        </div>

        <div id="tab-gouttes" class="pane">
          <div class="grid">
            <div style="display:flex;gap:8px;align-items:end">
              <button id="sir_toggle" class="btn secondary" type="button">Basculer mg ‚Üî cuill√®re</button>
            </div>
            <label>Gouttes par prise
              <input type="number" id="gtt_units" min="0" step="0.5" value="10">
            </label>
            <label>Fr√©quence / jour (prises)
              <input type="number" id="gtt_freq" min="0" step="0.5" value="3">
            </label>
            <label>Dur√©e (jours)
              <input type="number" id="gtt_days" min="0" step="1" value="7">
            </label>
            <label>Gouttes par mL (‚âà20 par d√©faut)
              <input type="number" id="gtt_per_ml" min="1" step="1" value="20">
            </label>
            <label>Volume par flacon (mL)
              <input type="number" id="gtt_bottle_ml" min="1" step="1" value="30">
            </label>
          </div>
        </div>

        <div id="tab-collyre" class="pane">
          <div class="grid">
            <div style="display:flex;gap:8px;align-items:end">
              <button id="sir_toggle" class="btn secondary" type="button">Basculer mg ‚Üî cuill√®re</button>
            </div>
            <label>Gouttes par instillation et par ≈ìil
              <input type="number" id="col_drops_per_eye" min="0" step="0.5" value="1">
            </label>
            <label>Nombre d'yeux trait√©s (1 ou 2)
              <input type="number" id="col_eyes" min="1" step="1" value="2">
            </label>
            <label>Fr√©quence / jour (instillations)
              <input type="number" id="col_freq" min="0" step="0.5" value="3">
            </label>
            <label>Dur√©e (jours)
              <input type="number" id="col_days" min="0" step="1" value="14">
            </label>
            <label>Gouttes par mL (‚âà20 par d√©faut)
              <input type="number" id="col_per_ml" min="1" step="1" value="20">
            </label>
            <label>Volume par flacon (mL)
              <input type="number" id="col_bottle_ml" min="1" step="1" value="10">
            </label>
            <label>Dur√©e maximale d'utilisation d'un flacon (jours, optionnel)
              <input type="number" id="col_max_days" min="0" step="1" placeholder="Ex: 28">
            </label>
          </div>
        </div>
      </div>
    </section>

    <section class="card actions">
      <button id="calcBtn" class="btn primary">Calculer</button>
      <button id="resetBtn" class="btn secondary">R√©initialiser</button>
      <label class="remember"><input type="checkbox" id="remember"> M√©moriser mes param√®tres</label>
    </section>

    <section class="card" id="results" aria-live="polite">
      <h2>R√©sultats</h2>
      <div id="resultContent" class="result-grid">
        <div class="result">
          <h3>R√©sum√©</h3>
          <div id="summary"></div>
        </div>
        <div class="result">
          <h3>D√©tail</h3>
          <div id="detail"></div>
        </div>
      </div>
    </section>

    <section class="card tips">
      <h2>Notes</h2>
      <ul>
        <li>Les calculs arrondissent au sup√©rieur le nombre de bo√Ætes/flacons.</li>
        <li>Pour les p√©riodes d√©gressives/progressives, ajoutez un palier par sch√©ma (ex: J1-3: 2 cp x3/j ; J4-7: 1 cp x2/j).</li>
        <li>Valeurs par d√©faut : 20 gouttes ‚âà 1 mL pour solutions aqueuses. Ajustez si n√©cessaire selon le RCP.</li>
        <li>Collyres : un flacon entam√© peut avoir une dur√©e d'utilisation limit√©e. Vous pouvez la pr√©ciser pour forcer un minimum de flacons.</li>
      </ul>
    </section>
  </main>

  <footer class="footer">
    <small>&copy; 2025 ‚Äî Calculateur Bo√Ætes & Flacons ‚Ä¢ PWA hors-ligne ‚Ä¢ Con√ßu pour l'officine</small>
  </footer>

  <script src="app.js"></script>
</body>
</html>
